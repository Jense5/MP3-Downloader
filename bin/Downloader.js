(function(){var e,n,o,r,t,i,a,s,u,c,d;a=require("fs"),d=require("winston"),u=require("request"),o=require("cheerio"),s=require("inquirer"),e=null,r=function(e,n,o){return d.info("Download started."),console.log("Download started."),u.head(e,function(r,t,i){var s;return d.info("Data received, writing to file."),s=a.createWriteStream(n),u(e).pipe(s).on("close",function(){return d.info("Wrote data."),o()})})},i=function(n,o){var t,i;return d.info("Going to download track."),t={url:o,headers:{Accept:"*/*",Referer:"http://www.123savemp3.net","User-agent":"Mozilla/5.0 (Macintosh)"}},d.info("Created download headers."),i=e,null==e&&(i=process.cwd()+"/"+n+".mp3"),d.info("Calculated destination."),r(t,i,function(){return d.info("Bye."),console.log("Done.")})},n=function(e,n){return d.info("Ask user to select a song."),s.prompt([{type:"confirm",name:"ready",message:"Are you ready to pick a song?"},{when:function(e){return e.ready},type:"list",name:"song",message:"Choose a song to download:",choices:e}],function(o){var r,t,a;return o.ready?(d.info("Received answer from user."),t=o.song,r=e.indexOf(t),a="http://123savemp3.net"+n[r],d.info("Should download: "+t),i(t,a)):(d.info("Bye."),console.log("Done."))})},c=function(e){return d.info("Start scrape for source: "+e),u(e,function(e,r,t){var i,a,s,u;return d.info("Received answer from server."),i=o.load(t),d.info("Parsed page with $."),s=i(".item").find(".play"),u=[],a=[],d.info("Fetched links."),i(".item").find(".desc").each(function(e,n){return u.push(i(this).text().trim()),a.push(i(s[e]).attr("data-url"))}),d.info("Present titles to user."),n(u,a)})},t=function(n,o){var r;return d.info("Download query: "+n),null!=o&&(e=o),r="http://www.123savemp3.net/mp3/"+encodeURIComponent(n),c(r)},module.exports.download=t}).call(this)
